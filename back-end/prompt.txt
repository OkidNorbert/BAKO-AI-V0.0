âœ… FINAL BACKEND ARCHITECTURE PROMPT (UPDATED â€“ COPY & PASTE)

You are a senior backend engineer, computer vision architect, and AI systems designer.

Your task is to extend and adapt an existing backend template whose core logic resides inside a folder called template/.

This backend powers an AI-driven basketball performance analysis platform and must align fully with an already-defined frontend architecture.

ğŸ§  Core Constraints (VERY IMPORTANT)

âœ… The template/ folder contains reusable, application-agnostic logic

âœ… The template already includes YOLO-based vision pipelines

âœ… Supabase is the ONLY database, authentication, and storage provider

âœ… The backend must support GPU acceleration (RTX 4080 Super available)

âœ… Multiple YOLO versions may be used simultaneously, based on task strength

âŒ Do NOT remove or rewrite template logic

âŒ Do NOT hardcode application-specific assumptions into the template

ğŸ¯ System Objective

Design a backend system that supports two analysis contexts using the same core template:

analysis_mode = TEAM | PERSONAL


This flag determines:

Which YOLO models are used

How detections are interpreted

How analytics are generated

How results are stored in Supabase

ğŸ§© High-Level Architecture
Client (Web / Mobile)
        â†“
API Layer (Role-Aware)
        â†“
Analysis Dispatcher
        â†“
Template Vision Engine (YOLO multi-version)
        â†“
Analytics & Persistence Layer (Supabase)


The template remains generic; application-specific logic lives around it.

ğŸ—‚ï¸ Backend Folder Structure (EXTEND, DO NOT BREAK)
backend/
â”œâ”€â”€ template/                     # CORE, REUSABLE (KEEP INTACT)
â”‚   â”œâ”€â”€ detection/
â”‚   â”‚   â”œâ”€â”€ yolo_v5.py             # Ball detection specialist
â”‚   â”‚   â”œâ”€â”€ yolo_v8.py             # Player detection & tracking
â”‚   â”‚   â”œâ”€â”€ yolo_v11.py            # (if available) improved tracking
â”‚   â”‚   â”œâ”€â”€ yolo_v12.py            # (optional) SOTA experiments
â”‚   â”œâ”€â”€ tracking/
â”‚   â”œâ”€â”€ inference/
â”‚   â””â”€â”€ utils/
â”‚
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ dispatcher.py              # Routes TEAM vs PERSONAL
â”‚   â”œâ”€â”€ team_analysis.py           # Uses template as-is
â”‚   â””â”€â”€ personal_analysis.py       # NEW logic layer
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ client.py
â”‚   â”œâ”€â”€ auth.py
â”‚   â””â”€â”€ storage.py
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth.py
â”‚   â”œâ”€â”€ videos.py
â”‚   â”œâ”€â”€ analysis.py
â”‚   â”œâ”€â”€ teams.py
â”‚   â””â”€â”€ players.py
â”‚
â”œâ”€â”€ analytics/
â”‚   â”œâ”€â”€ metrics.py
â”‚   â””â”€â”€ aggregations.py
â”‚
â””â”€â”€ main.py

ğŸ” Authentication & Roles (Supabase)
Account Types (stored in Supabase user metadata)

TEAM

PERSONAL

Authorization Rules

TEAM users:

Manage organizations

Manage player profiles

Analyze multi-player videos

PERSONAL users:

Analyze only their own training videos

No access to team endpoints

ğŸ§¾ Supabase Database (Integrated into Template)

Supabase logic must be accessed from within the template, not duplicated.

Core Tables
users

id

account_type

organizations

id

name

owner_id

players

id

organization_id (TEAM)

user_id (PERSONAL)

videos

id

uploader_id

analysis_mode

status

storage_path

detections

video_id

frame

object_type (player / ball)

track_id

bbox

confidence

keypoints (optional)

analytics

player_id

metric_type

value

timestamp

ğŸ¥ Analysis Job Lifecycle
1ï¸âƒ£ Video Upload

Stored in Supabase Storage

Metadata saved in videos

Job queued with analysis_mode

2ï¸âƒ£ Dispatcher Logic
if analysis_mode == "TEAM":
    run_team_analysis(video)
elif analysis_mode == "PERSONAL":
    run_personal_analysis(video)

ğŸ”µ TEAM ANALYSIS (YOLO MULTI-VERSION PIPELINE)

Use the best YOLO version per task:

YOLOv5 â†’ Ball detection (proven precision)

YOLOv8 / v11 â†’ Player detection & tracking

YOLOv12 (if stable) â†’ Experimental improvements

Behavior

Multi-player detection

Persistent tracking IDs

Team/player mapping

Event detection (passes, shots, possession)

âš ï¸ This logic mostly already exists â€” reuse it.

ğŸŸ¢ PERSONAL ANALYSIS (BEST MODEL â€“ NO LIMITATION)

Since GPU is available, use SOTA hybrid pipeline:

Recommended Stack

YOLOv8-Pose / YOLOv11-Pose â†’ Pose + detection

Optional refinement:

Temporal smoothing

Keypoint velocity analysis

Logic

Detect all players

Select primary subject:

Largest bounding box

Longest presence

Ignore others

Extract:

Joint angles

Motion speed

Repetition counts

Bind analytics strictly to:

player_id = authenticated_user_id

ğŸ“Š Personal Skill Metrics

Shot attempts & form consistency

Dribble frequency & rhythm

Acceleration & deceleration

Training load per session

Progress over time

ğŸ” Template Reusability Rule

The template must:

Remain application-neutral

Accept configuration flags

Support different YOLO versions dynamically

Be usable by future sports or vision systems

ğŸ”Œ API CONTRACT (Aligned with Frontend)
Shared

POST /videos/upload

GET /videos/{id}/status

GET /analytics/player/{id}

Team-only

POST /teams

POST /players

POST /analysis/team

Personal-only

POST /analysis/personal

GET /skills/summary

âš™ï¸ Hardware & Performance

GPU acceleration enabled by default

CPU fallback supported

Batch inference allowed

Async processing mandatory

âœ… Final Outcome

Deliver a backend that:

âœ” Keeps template logic reusable
âœ” Integrates Supabase deeply
âœ” Uses the best YOLO versions per task
âœ” Supports team and personal workflows
âœ” Fully matches frontend behavior
âœ” Is future-proof and research-grade

END OF PROMPT